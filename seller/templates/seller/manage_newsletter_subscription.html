{% extends 'index.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0">
                        <i class="fas fa-envelope me-2"></i>Newsletter Subscription
                    </h3>
                    <p class="mb-0 mt-2">Manage your newsletter preferences and stay updated</p>
                </div>
                <div class="card-body p-4">
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <h6 class="text-primary">Current Subscription</h6>
                            <p class="text-muted mb-2">
                                <i class="fas fa-envelope me-1"></i><strong>Email:</strong> {{ subscriber.email }}
                            </p>
                            <p class="text-muted mb-2">
                                <i class="fas fa-user-tag me-1"></i><strong>Role:</strong> {{ subscriber.get_role_display }}
                            </p>
                            <p class="text-muted mb-2">
                                <i class="fas fa-calendar me-1"></i><strong>Subscribed:</strong> {{ subscriber.subscribed_at|date:"M d, Y" }}
                            </p>
                            <p class="text-muted mb-0">
                                <i class="fas fa-toggle-on me-1"></i><strong>Status:</strong> 
                                {% if subscriber.is_active %}
                                    <span class="badge bg-success">Active</span>
                                {% else %}
                                    <span class="badge bg-danger">Inactive</span>
                                {% endif %}
                            </p>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-primary">Current Preferences</h6>
                            <p class="text-muted mb-0">{{ subscriber.preferences_summary }}</p>
                        </div>
                    </div>
                    
                    <hr>
                    
                    <form method="POST">
                        {% csrf_token %}
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.email.id_for_label }}" class="form-label">
                                    <i class="fas fa-envelope me-1"></i>Email Address
                                </label>
                                {{ form.email }}
                                {% if form.email.errors %}
                                    <div class="text-danger small">{{ form.email.errors.0 }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="{{ form.role.id_for_label }}" class="form-label">
                                    <i class="fas fa-user-tag me-1"></i>Role
                                </label>
                                {{ form.role }}
                                {% if form.role.errors %}
                                    <div class="text-danger small">{{ form.role.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <h6 class="text-primary mb-3">
                                <i class="fas fa-bell me-1"></i>Notification Preferences
                            </h6>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-check mb-3">
                                        {{ form.receive_product_updates }}
                                        <label class="form-check-label" for="{{ form.receive_product_updates.id_for_label }}">
                                            <i class="fas fa-box me-1"></i>Product Updates
                                        </label>
                                        <small class="text-muted d-block">Get notified about new products and updates</small>
                                    </div>
                                    
                                    <div class="form-check mb-3">
                                        {{ form.receive_platform_announcements }}
                                        <label class="form-check-label" for="{{ form.receive_platform_announcements.id_for_label }}">
                                            <i class="fas fa-bullhorn me-1"></i>Platform Announcements
                                        </label>
                                        <small class="text-muted d-block">Important updates about MarketVibe platform</small>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="form-check mb-3">
                                        {{ form.receive_seller_tools }}
                                        <label class="form-check-label" for="{{ form.receive_seller_tools.id_for_label }}">
                                            <i class="fas fa-tools me-1"></i>Seller Tools & Tips
                                        </label>
                                        <small class="text-muted d-block">Tips and tools to improve your selling</small>
                                    </div>
                                    
                                    <div class="form-check mb-3">
                                        {{ form.receive_buyer_recommendations }}
                                        <label class="form-check-label" for="{{ form.receive_buyer_recommendations.id_for_label }}">
                                            <i class="fas fa-star me-1"></i>Buyer Recommendations
                                        </label>
                                        <small class="text-muted d-block">Personalized product recommendations</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>What you'll receive:</strong>
                            <ul class="mb-0 mt-2">
                                <li>Weekly newsletters with the latest updates</li>
                                <li>Exclusive offers and promotions</li>
                                <li>Tips and best practices for your role</li>
                                <li>Important platform announcements</li>
                            </ul>
                        </div>
                        
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <button type="button" class="btn btn-danger me-md-2" onclick="unsubscribeNewsletter()">
                                <i class="fas fa-times me-1"></i>Unsubscribe
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-1"></i>Update Preferences
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function unsubscribeNewsletter() {
    Swal.fire({
        title: 'Unsubscribe from Newsletter?',
        text: 'Are you sure you want to unsubscribe? You can always resubscribe later.',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#dc3545',
        cancelButtonColor: '#6c757d',
        confirmButtonText: 'Yes, Unsubscribe',
        cancelButtonText: 'Cancel'
    }).then((result) => {
        if (result.isConfirmed) {
            fetch('{% url "sellers:unsubscribe_newsletter" %}', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    Swal.fire({
                        icon: 'success',
                        title: 'Unsubscribed',
                        text: data.message,
                        confirmButtonText: 'OK'
                    }).then(() => {
                        window.location.href = '{% url "sellers:index" %}';
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: data.message,
                        confirmButtonText: 'OK'
                    });
                }
            })
            .catch(error => {
                console.error('Error:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'An error occurred while unsubscribing.',
                    confirmButtonText: 'OK'
                });
            });
        }
    });
}
</script>

<style>
.card {
    border-radius: 15px;
    overflow: hidden;
}

.card-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
}

.form-control, .form-select {
    border-radius: 8px;
    border: 2px solid #e9ecef;
    transition: all 0.3s ease;
}

.form-control:focus, .form-select:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
}

.form-check-input {
    border-radius: 4px;
    border: 2px solid #e9ecef;
    transition: all 0.3s ease;
}

.form-check-input:checked {
    background-color: #667eea;
    border-color: #667eea;
}

.btn {
    border-radius: 8px;
    padding: 10px 20px;
    font-weight: 500;
    transition: all 0.3s ease;
}

.btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
}

.btn-danger {
    background: linear-gradient(135deg, #dc3545 0%, #e74c3c 100%);
    border: none;
}

.btn-danger:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
}

.alert {
    border-radius: 10px;
    border: none;
}

.alert-info {
    background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
    color: #1565c0;
}

.badge {
    border-radius: 6px;
    padding: 6px 12px;
}
</style>
{% endblock %} 