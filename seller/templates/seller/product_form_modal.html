{% load b64filters %}
<!-- Product Update Form for Modal -->
<form method="POST" enctype="multipart/form-data" id="updateProductForm">
    {% csrf_token %}
    
    <div class="form-row">
        <div class="form-group">
            <label for="{{ form.name.id_for_label }}">Product Name *</label>
            {{ form.name }}
            {% if form.name.errors %}
            <ul class="errorlist">
                {% for error in form.name.errors %}
                <li>{{ error }}</li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>
        
        <div class="form-group">
            <label for="{{ form.brand.id_for_label }}">Brand</label>
            {{ form.brand }}
            {% if form.brand.errors %}
            <ul class="errorlist">
                {% for error in form.brand.errors %}
                <li>{{ error }}</li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>
    </div>

    <!-- Category Selection -->
    {% if parent_categories %}
    <div class="form-row">
        <div class="form-group">
            <label for="parent_category">Parent Category *</label>
            <select id="parent_category" name="parent_category" required>
                <option value="">Select Parent Category</option>
                {% for category in parent_categories %}
                <option value="{{ category.id }}" {% if current_parent_category and current_parent_category.id == category.id %}selected{% endif %}>{{ category.name }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="form-group">
            <label for="child_category">Child Category</label>
            <select id="child_category" name="child_category">
                <option value="">Select Child Category (if any)</option>
                {% if current_child_category %}
                <option value="{{ current_child_category.id }}" selected>{{ current_child_category.name }}</option>
                {% endif %}
            </select>
        </div>
    </div>

    <!-- Final Category Selection -->
    <div class="form-group">
        <label for="{{ form.category.id_for_label }}">Final Category *</label>
        {{ form.category }}
        {% if form.category.errors %}
        <ul class="errorlist">
            {% for error in form.category.errors %}
            <li>{{ error }}</li>
            {% endfor %}
        </ul>
        {% endif %}
    </div>

    <!-- Dynamic Attributes Section -->
    <div id="attributesSection" class="attribute-section" style="display: none;">
        <h3>Product Attributes</h3>
        <div id="attributesContainer">
            <!-- Dynamic attributes will be loaded here -->
        </div>
    </div>
    {% endif %}

    <!-- Product Description -->
    <div class="form-group full-width">
        <label for="{{ form.description.id_for_label }}">Description</label>
        {{ form.description }}
        {% if form.description.errors %}
        <ul class="errorlist">
            {% for error in form.description.errors %}
            <li>{{ error }}</li>
            {% endfor %}
        </ul>
        {% endif %}
    </div>

    <!-- Pricing -->
    <div class="form-row">
        <div class="form-group">
            <label for="{{ form.base_price.id_for_label }}">Base Price *</label>
            {{ form.base_price }}
            <div class="help-text">Enter the original price of the product</div>
            {% if form.base_price.errors %}
            <ul class="errorlist">
                {% for error in form.base_price.errors %}
                <li>{{ error }}</li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>
        
        <div class="form-group">
            <label for="{{ form.discount_percentage.id_for_label }}">Discount Percentage</label>
            {{ form.discount_percentage }}
            <div class="help-text">Enter discount as percentage (e.g., 10 for 10%)</div>
            {% if form.discount_percentage.errors %}
            <ul class="errorlist">
                {% for error in form.discount_percentage.errors %}
                <li>{{ error }}</li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>
    </div>

    <div class="form-row">
        <div class="form-group">
            <label for="{{ form.final_price.id_for_label }}">Final Price</label>
            {{ form.final_price }}
            <div class="help-text">Will be calculated automatically if discount is provided</div>
            {% if form.final_price.errors %}
            <ul class="errorlist">
                {% for error in form.final_price.errors %}
                <li>{{ error }}</li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>
        
        <div class="form-group">
            <label for="{{ form.stock.id_for_label }}">Stock Quantity *</label>
            {{ form.stock }}
            {% if form.stock.errors %}
            <ul class="errorlist">
                {% for error in form.stock.errors %}
                <li>{{ error }}</li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>
    </div>

    <!-- Condition and Image -->
    <div class="form-row">
        <div class="form-group">
            <label for="{{ form.condition.id_for_label }}">Condition *</label>
            {{ form.condition }}
            {% if form.condition.errors %}
            <ul class="errorlist">
                {% for error in form.condition.errors %}
                <li>{{ error }}</li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>
        
        <div class="form-group">
            <label for="{{ form.image.id_for_label }}">Product Image</label>
            {{ form.image }}
            {% if form.image.errors %}
            <ul class="errorlist">
                {% for error in form.image.errors %}
                <li>{{ error }}</li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>
    </div>
</form> 