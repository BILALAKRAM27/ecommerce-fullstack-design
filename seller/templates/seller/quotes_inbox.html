{% extends 'index.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="quote-inbox">
    <div class="quote-inbox__container">
        <!-- Header Section -->
        <div class="quote-inbox__header">
            <div class="quote-inbox__header-content">
                <h1 class="quote-inbox__title">
                    <svg class="quote-inbox__title-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    Quotes Inbox
                </h1>
                <div class="quote-inbox__status">
                    <span class="quote-inbox__status-indicator" id="connectionStatus">
                        <span class="quote-inbox__status-dot"></span>
                        Live
                    </span>
                    <span class="quote-inbox__last-updated" id="lastUpdated">Just now</span>
                </div>
            </div>
            
            <!-- Tab Navigation -->
            <div class="quote-inbox__tabs">
                <button type="button" class="quote-inbox__tab quote-inbox__tab--active" id="newQuotesBtn" data-section="new">
                    <svg class="quote-inbox__tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M12 6v6l4 2"></path>
                    </svg>
                    New Requests
                    <span class="quote-inbox__tab-badge" id="newQuotesBadge">{{ quote_requests|length }}</span>
                </button>
                <button type="button" class="quote-inbox__tab" id="myResponsesBtn" data-section="responses">
                    <svg class="quote-inbox__tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
                    </svg>
                    My Responses
                    <span class="quote-inbox__tab-badge" id="responsesBadge">{{ seller_responses|length }}</span>
                </button>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div class="quote-inbox__loading" id="loadingIndicator" style="display: none;">
            <div class="quote-inbox__loading-spinner"></div>
            <span>Updating quotes...</span>
        </div>

        <!-- New Quote Requests Section -->
        <div id="newQuotesSection" class="quote-inbox__section quote-inbox__section--active">
            <div class="quote-inbox__section-header">
                <h2 class="quote-inbox__section-title">New Quote Requests</h2>
                <div class="quote-inbox__section-controls">
                    <button class="quote-inbox__refresh-btn" id="manualRefresh">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <polyline points="23 4 23 10 17 10"></polyline>
                            <polyline points="1 20 1 14 7 14"></polyline>
                            <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
                        </svg>
                        Refresh
                    </button>
                </div>
            </div>
            
            <div class="quote-inbox__content" id="newQuotesContent">
                {% if quote_requests %}
                    <div class="quote-inbox__grid">
                        {% for quote in quote_requests %}
                        <div class="quote-inbox__card" data-quote-id="{{ quote.id }}">
                            <div class="quote-inbox__card-header">
                                <div class="quote-inbox__urgency-badge quote-inbox__urgency-badge--{{ quote.urgency }}">
                                    {{ quote.get_urgency_display }}
                                </div>
                                <time class="quote-inbox__date">{{ quote.created_at|date:"M d, Y" }}</time>
                            </div>
                            
                            <div class="quote-inbox__card-body">
                                <h3 class="quote-inbox__product-name">{{ quote.product_name }}</h3>
                                <div class="quote-inbox__buyer-info">
                                    <svg class="quote-inbox__buyer-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                        <circle cx="12" cy="7" r="4"></circle>
                                    </svg>
                                    {{ quote.buyer.name }}
                                </div>
                                <p class="quote-inbox__description">{{ quote.description|truncatewords:20 }}</p>
                                
                                <div class="quote-inbox__details">
                                    <div class="quote-inbox__detail">
                                        <span class="quote-inbox__detail-label">Quantity</span>
                                        <span class="quote-inbox__detail-value">{{ quote.quantity }} {{ quote.get_unit_display }}</span>
                                    </div>
                                    <div class="quote-inbox__detail">
                                        <span class="quote-inbox__detail-label">Category</span>
                                        <span class="quote-inbox__detail-value">{{ quote.category.name }}</span>
                                    </div>
                                    <div class="quote-inbox__detail">
                                        <span class="quote-inbox__detail-label">Budget</span>
                                        <span class="quote-inbox__detail-value">{{ quote.budget_range|default:"Not specified" }}</span>
                                    </div>
                                </div>
                                
                                {% if quote.delivery_deadline %}
                                <div class="quote-inbox__deadline">
                                    <svg class="quote-inbox__deadline-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                        <line x1="16" y1="2" x2="16" y2="6"></line>
                                        <line x1="8" y1="2" x2="8" y2="6"></line>
                                        <line x1="3" y1="10" x2="21" y2="10"></line>
                                    </svg>
                                    Deadline: {{ quote.delivery_deadline|date:"M d, Y" }}
                                </div>
                                {% endif %}
                            </div>
                            
                            <div class="quote-inbox__card-footer">
                                <a href="{% url 'sellers:respond_to_quote' quote.id %}" class="quote-inbox__respond-btn">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
                                    </svg>
                                    Respond to Quote
                                </a>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="quote-inbox__empty">
                        <svg class="quote-inbox__empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                        </svg>
                        <h3 class="quote-inbox__empty-title">No new quote requests</h3>
                        <p class="quote-inbox__empty-text">When buyers submit quote requests in your categories, they'll appear here.</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- My Responses Section -->
        <div id="myResponsesSection" class="quote-inbox__section">
            <div class="quote-inbox__section-header">
                <h2 class="quote-inbox__section-title">My Quote Responses</h2>
            </div>
            
            <div class="quote-inbox__content" id="responsesContent">
                {% if seller_responses %}
                    <div class="quote-inbox__table-container">
                        <table class="quote-inbox__table">
                            <thead class="quote-inbox__table-header">
                                <tr>
                                    <th>Product</th>
                                    <th>Buyer</th>
                                    <th>My Price</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody class="quote-inbox__table-body">
                                {% for response in seller_responses %}
                                <tr class="quote-inbox__table-row" data-response-id="{{ response.id }}">
                                    <td class="quote-inbox__table-cell">
                                        <div class="quote-inbox__product-info">
                                            <strong class="quote-inbox__product-title">{{ response.quote_request.product_name }}</strong>
                                            <span class="quote-inbox__product-category">{{ response.quote_request.category.name }}</span>
                                        </div>
                                    </td>
                                    <td class="quote-inbox__table-cell">{{ response.quote_request.buyer.name }}</td>
                                    <td class="quote-inbox__table-cell">
                                        <div class="quote-inbox__price-info">
                                            <strong class="quote-inbox__price">${{ response.price }}</strong>
                                            <span class="quote-inbox__price-unit">per unit</span>
                                        </div>
                                    </td>
                                    <td class="quote-inbox__table-cell">
                                        {% if response.is_accepted %}
                                            <span class="quote-inbox__status-badge quote-inbox__status-badge--accepted">Accepted</span>
                                        {% elif response.is_rejected %}
                                            <span class="quote-inbox__status-badge quote-inbox__status-badge--rejected">Rejected</span>
                                        {% else %}
                                            <span class="quote-inbox__status-badge quote-inbox__status-badge--pending">Pending</span>
                                        {% endif %}
                                    </td>
                                    <td class="quote-inbox__table-cell">{{ response.created_at|date:"M d, Y" }}</td>
                                    <td class="quote-inbox__table-cell">
                                        <a href="{% url 'sellers:quote_details' response.quote_request.id %}" class="quote-inbox__view-btn">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                                <circle cx="12" cy="12" r="3"></circle>
                                            </svg>
                                            View
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="quote-inbox__empty">
                        <svg class="quote-inbox__empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
                        </svg>
                        <h3 class="quote-inbox__empty-title">No responses yet</h3>
                        <p class="quote-inbox__empty-text">Your quote responses will appear here once you start responding to requests.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% if messages %}
<div class="messages" id="django-messages">
  {% for message in messages %}
  <div class="message {{ message.tags }}" data-message-id="{{ message.tags }}">
    <span class="message-id">{{ message.tags }}</span>
    {{ message }}
  </div>
  {% endfor %}
</div>
<script>
  setTimeout(function() {
    var msg = document.getElementById('django-messages');
    if (msg) { msg.style.display = 'none'; }
  }, 7000);
</script>
{% endif %}
{% block extra_css %}

<style>
/* Quote Inbox Scoped Styles */
.quote-inbox {
    min-height: 100vh;
    background: linear-gradient(135deg, #ced6fb 0%, #e0c9f6 100%);
    padding: 2rem 0;
}

.quote-inbox__container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
}

/* Header Styles */
.quote-inbox__header {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 1rem;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.quote-inbox__header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
}

.quote-inbox__title {
    display: flex;
    align-items: center;
    font-size: 2rem;
    font-weight: 700;
    color: #2d3748;
    margin: 0;
}

.quote-inbox__title-icon {
    width: 2rem;
    height: 2rem;
    margin-right: 0.75rem;
    color: #667eea;
}

.quote-inbox__status {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 0.25rem;
}

.quote-inbox__status-indicator {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    font-weight: 600;
    color: #22c55e;
}

.quote-inbox__status-dot {
    width: 0.5rem;
    height: 0.5rem;
    background: #22c55e;
    border-radius: 50%;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.quote-inbox__last-updated {
    font-size: 0.75rem;
    color: #6b7280;
}

/* Tab Navigation */
.quote-inbox__tabs {
    display: flex;
    gap: 0.5rem;
}

.quote-inbox__tab {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    background: transparent;
    border: 2px solid #e5e7eb;
    border-radius: 0.75rem;
    font-weight: 600;
    color: #6b7280;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.quote-inbox__tab:hover {
    border-color: #667eea;
    color: #667eea;
    transform: translateY(-2px);
}

.quote-inbox__tab--active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-color: #667eea;
    color: white;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
}

.quote-inbox__tab-icon {
    width: 1.25rem;
    height: 1.25rem;
}

.quote-inbox__tab-badge {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    padding: 0.25rem 0.5rem;
    border-radius: 0.5rem;
    font-size: 0.75rem;
    font-weight: 700;
    min-width: 1.5rem;
    text-align: center;
}

.quote-inbox__tab:not(.quote-inbox__tab--active) .quote-inbox__tab-badge {
    background: #e5e7eb;
    color: #6b7280;
}

/* Loading Indicator */
.quote-inbox__loading {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 0.75rem;
    padding: 1rem;
    margin-bottom: 1rem;
    color: #667eea;
    font-weight: 600;
}

.quote-inbox__loading-spinner {
    width: 1.5rem;
    height: 1.5rem;
    border: 2px solid #e5e7eb;
    border-top: 2px solid #667eea;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Section Styles */
.quote-inbox__section {
    display: none;
}

.quote-inbox__section--active {
    display: block;
}

.quote-inbox__section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 1rem 1rem 0 0;
    padding: 1.5rem 2rem;
    border-bottom: 1px solid #e5e7eb;
}

.quote-inbox__section-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #2d3748;
    margin: 0;
}

.quote-inbox__section-controls {
    display: flex;
    gap: 0.75rem;
}

.quote-inbox__refresh-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 0.5rem;
    color: #64748b;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
}

.quote-inbox__refresh-btn:hover {
    background: #e2e8f0;
    color: #475569;
}

.quote-inbox__refresh-btn svg {
    width: 1rem;
    height: 1rem;
}

.quote-inbox__content {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 0 0 1rem 1rem;
    padding: 2rem;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

/* Grid Layout for Cards */
.quote-inbox__grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 1.5rem;
}

/* Card Styles */
.quote-inbox__card {
    background: white;
    border-radius: 1rem;
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    border: 1px solid #f1f5f9;
}

.quote-inbox__card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
    border-color: #667eea;
}

.quote-inbox__card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem 1.5rem 0;
}

.quote-inbox__urgency-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.quote-inbox__urgency-badge--low {
    background: #dcfce7;
    color: #166534;
}

.quote-inbox__urgency-badge--medium {
    background: #fef3c7;
    color: #92400e;
}

.quote-inbox__urgency-badge--high {
    background: #fed7cc;
    color: #c2410c;
}

.quote-inbox__urgency-badge--urgent {
    background: #fecaca;
    color: #dc2626;
}

.quote-inbox__date {
    font-size: 0.875rem;
    color: #6b7280;
    font-weight: 500;
}

.quote-inbox__card-body {
    padding: 1.5rem;
}

.quote-inbox__product-name {
    font-size: 1.25rem;
    font-weight: 700;
    color: #1f2937;
    margin: 0 0 0.75rem 0;
}

.quote-inbox__buyer-info {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #6b7280;
    font-size: 0.875rem;
    margin-bottom: 1rem;
}

.quote-inbox__buyer-icon {
    width: 1rem;
    height: 1rem;
}

.quote-inbox__description {
    color: #4b5563;
    line-height: 1.6;
    margin-bottom: 1.5rem;
}

.quote-inbox__details {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.quote-inbox__detail {
    text-align: center;
    padding: 0.75rem;
    background: #f8fafc;
    border-radius: 0.5rem;
}

.quote-inbox__detail-label {
    display: block;
    font-size: 0.75rem;
    color: #6b7280;
    font-weight: 500;
    margin-bottom: 0.25rem;
}

.quote-inbox__detail-value {
    display: block;
    font-weight: 700;
    color: #1f2937;
    font-size: 0.875rem;
}

.quote-inbox__deadline {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
    color: #92400e;
    padding: 0.75rem;
    border-radius: 0.5rem;
    font-size: 0.875rem;
    font-weight: 600;
}

.quote-inbox__deadline-icon {
    width: 1rem;
    height: 1rem;
}

.quote-inbox__card-footer {
    padding: 0 1.5rem 1.5rem;
}

.quote-inbox__respond-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    width: 100%;
    padding: 0.75rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    text-decoration: none;
    border-radius: 0.5rem;
    font-weight: 600;
    transition: all 0.3s ease;
}

.quote-inbox__respond-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    color: white;
    text-decoration: none;
}

.quote-inbox__respond-btn svg {
    width: 1.25rem;
    height: 1.25rem;
}

/* Table Styles */
.quote-inbox__table-container {
    overflow-x: auto;
    border-radius: 0.75rem;
    border: 1px solid #e5e7eb;
}

.quote-inbox__table {
    width: 100%;
    border-collapse: collapse;
    background: white;
}

.quote-inbox__table-header {
    background: #f8fafc;
}

.quote-inbox__table-header th {
    padding: 1rem 1.5rem;
    text-align: left;
    font-weight: 700;
    color: #374151;
    font-size: 0.875rem;
    border-bottom: 1px solid #e5e7eb;
}

.quote-inbox__table-row {
    transition: background-color 0.2s ease;
}

.quote-inbox__table-row:hover {
    background: #f9fafb;
}

.quote-inbox__table-cell {
    padding: 1rem 1.5rem;
    border-bottom: 1px solid #f3f4f6;
    vertical-align: top;
}

.quote-inbox__product-info {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.quote-inbox__product-title {
    color: #1f2937;
    font-weight: 600;
}

.quote-inbox__product-category {
    color: #6b7280;
    font-size: 0.875rem;
}

.quote-inbox__price-info {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.quote-inbox__price {
    color: #059669;
    font-weight: 700;
}

.quote-inbox__price-unit {
    color: #6b7280;
    font-size: 0.875rem;
}

.quote-inbox__status-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
}

.quote-inbox__status-badge--accepted {
    background: #dcfce7;
    color: #166534;
}

.quote-inbox__status-badge--rejected {
    background: #fecaca;
    color: #dc2626;
}

.quote-inbox__status-badge--pending {
    background: #fef3c7;
    color: #92400e;
}

.quote-inbox__view-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: #f8fafc;
    color: #667eea;
    text-decoration: none;
    border-radius: 0.5rem;
    font-size: 0.875rem;
    font-weight: 600;
    transition: all 0.2s ease;
}

.quote-inbox__view-btn:hover {
    background: #e2e8f0;
    color: #5a67d8;
    text-decoration: none;
}

.quote-inbox__view-btn svg {
    width: 1rem;
    height: 1rem;
}

/* Empty State */
.quote-inbox__empty {
    text-align: center;
    padding: 4rem 2rem;
}

.quote-inbox__empty-icon {
    width: 4rem;
    height: 4rem;
    color: #d1d5db;
    margin: 0 auto 1.5rem;
}

.quote-inbox__empty-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #374151;
    margin: 0 0 0.75rem 0;
}

.quote-inbox__empty-text {
    color: #6b7280;
    font-size: 1rem;
    line-height: 1.6;
}

/* Responsive Design */
@media (max-width: 768px) {
    .quote-inbox {
        padding: 1rem 0;
    }
    
    .quote-inbox__container {
        padding: 0 0.5rem;
    }
    
    .quote-inbox__header {
        padding: 1.5rem;
        margin-bottom: 1rem;
    }
    
    .quote-inbox__header-content {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
        margin-bottom: 1.5rem;
    }
    
    .quote-inbox__title {
        font-size: 1.5rem;
    }
    
    .quote-inbox__tabs {
        width: 100%;
        flex-direction: column;
    }
    
    .quote-inbox__tab {
        justify-content: center;
        width: 100%;
    }
    
    .quote-inbox__grid {
        grid-template-columns: 1fr;
    }
    
    .quote-inbox__details {
        grid-template-columns: 1fr;
        gap: 0.75rem;
    }
    
    .quote-inbox__section-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
        padding: 1rem;
    }
    
    .quote-inbox__content {
        padding: 1rem;
    }
    
    .quote-inbox__table-container {
        font-size: 0.875rem;
    }
    
    .quote-inbox__table-cell {
        padding: 0.75rem;
    }
}

@media (max-width: 480px) {
    .quote-inbox__card-body {
        padding: 1rem;
    }
    
    .quote-inbox__card-header {
        padding: 1rem 1rem 0;
    }
    
    .quote-inbox__card-footer {
        padding: 0 1rem 1rem;
    }
    
    .quote-inbox__empty {
        padding: 2rem 1rem;
    }
    
    .quote-inbox__empty-icon {
        width: 3rem;
        height: 3rem;
    }
}
.quote-inbox__notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: white;
    border-radius: 0.75rem;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    border-left: 4px solid #3b82f6;
    z-index: 1000;
    transform: translateX(400px);
    opacity: 0;
    transition: all 0.3s ease;
    max-width: 400px;
    min-width: 300px;
}

.quote-inbox__notification--show {
    transform: translateX(0);
    opacity: 1;
}

.quote-inbox__notification--success {
    border-left-color: #22c55e;
}

.quote-inbox__notification--error {
    border-left-color: #ef4444;
}

.quote-inbox__notification--warning {
    border-left-color: #f59e0b;
}

.quote-inbox__notification-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem 1.5rem;
}

.quote-inbox__notification-message {
    color: #374151;
    font-weight: 500;
    font-size: 0.875rem;
}

.quote-inbox__notification-close {
    background: none;
    border: none;
    font-size: 1.25rem;
    color: #9ca3af;
    cursor: pointer;
    padding: 0;
    margin-left: 1rem;
    transition: color 0.2s ease;
}

.quote-inbox__notification-close:hover {
    color: #6b7280;
}

/* Additional animations */
@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Pulse animation for refresh button when data is updating */
.quote-inbox__refresh-btn.updating {
    animation: pulse 1s infinite;
}

.quote-inbox__refresh-btn.updating svg {
    animation: spin 1s linear infinite;
}

/* Hover effects for interactive elements */
.quote-inbox__card[data-quote-id]:hover {
    cursor: pointer;
}

.quote-inbox__table-row:hover {
    transform: translateX(4px);
}

/* Loading skeleton for better UX */
.quote-inbox__skeleton {
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
}

@keyframes loading {
    0% {
        background-position: 200% 0;
    }
    100% {
        background-position: -200% 0;
    }
}

/* Focus styles for accessibility */
.quote-inbox__tab:focus,
.quote-inbox__refresh-btn:focus,
.quote-inbox__respond-btn:focus,
.quote-inbox__view-btn:focus {
    outline: 2px solid #667eea;
    outline-offset: 2px;
}

/* Print styles */
@media print {
    .quote-inbox__header,
    .quote-inbox__loading,
    .quote-inbox__notification {
        display: none !important;
    }
    
    .quote-inbox {
        background: white !important;
    }
    
    .quote-inbox__section {
        display: block !important;
    }
    
    .quote-inbox__card {
        break-inside: avoid;
        margin-bottom: 1rem;
    }
}
</style>
{% endblock %}
{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // DOM Elements
    const newQuotesBtn = document.getElementById('newQuotesBtn');
    const myResponsesBtn = document.getElementById('myResponsesBtn');
    const newQuotesSection = document.getElementById('newQuotesSection');
    const myResponsesSection = document.getElementById('myResponsesSection');
    const loadingIndicator = document.getElementById('loadingIndicator');
    const lastUpdated = document.getElementById('lastUpdated');
    const connectionStatus = document.getElementById('connectionStatus');
    const manualRefresh = document.getElementById('manualRefresh');
    const newQuotesBadge = document.getElementById('newQuotesBadge');
    const responsesBadge = document.getElementById('responsesBadge');
    
    // State management
    let currentSection = 'new';
    let isRefreshing = false;
    let refreshInterval;
    let lastUpdateTime = Date.now();
    
    // Tab switching functionality
    function switchTab(section) {
        currentSection = section;
        
        // Update button states
        newQuotesBtn.classList.toggle('quote-inbox__tab--active', section === 'new');
        myResponsesBtn.classList.toggle('quote-inbox__tab--active', section === 'responses');
        
        // Update section visibility
        newQuotesSection.classList.toggle('quote-inbox__section--active', section === 'new');
        myResponsesSection.classList.toggle('quote-inbox__section--active', section === 'responses');
    }
    
    // Event listeners for tabs
    newQuotesBtn.addEventListener('click', () => switchTab('new'));
    myResponsesBtn.addEventListener('click', () => switchTab('responses'));
    
    // Manual refresh functionality
    manualRefresh.addEventListener('click', () => {
        if (!isRefreshing) {
            refreshData();
        }
    });
    
    // AJAX refresh functionality
    async function refreshData() {
        if (isRefreshing) return;
        
        isRefreshing = true;
        showLoading();
        
        try {
            // Get current URL to maintain context
            const currentUrl = window.location.pathname;
            const params = new URLSearchParams();
            params.append('ajax', '1');
            
            // Add last update timestamp if available
            if (lastUpdateTime) {
                const lastUpdateDate = new Date(lastUpdateTime);
                params.append('last_update', lastUpdateDate.toISOString());
            }
            
            const response = await fetch(currentUrl + '?' + params.toString(), {
                method: 'GET',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'Content-Type': 'application/json',
                }
            });
            
            if (response.ok) {
                const data = await response.json();
                if (data.success) {
                    // Only update content and show notifications if there are actual changes
                    if (data.has_changes) {
                        updateContent(data);
                        showNotification('New quote activity detected!', 'success');
                    } else {
                        // Just update the timestamp without changing content
                        updateConnectionStatus('connected');
                        updateLastUpdatedTime();
                    }
                    
                    lastUpdateTime = Date.now();
                } else {
                    throw new Error('Server returned error: ' + (data.error || 'Unknown error'));
                }
            } else {
                throw new Error('Network response was not ok');
            }
        } catch (error) {
            console.error('Error refreshing data:', error);
            updateConnectionStatus('error');
            showNotification('Failed to refresh data. Please try again.', 'error');
        } finally {
            isRefreshing = false;
            hideLoading();
        }
    }
    
    // Update content with new data
    function updateContent(data) {
        if (data.quotes_html) {
            const newQuotesContent = document.getElementById('newQuotesContent');
            if (newQuotesContent) {
                newQuotesContent.innerHTML = data.quotes_html;
                newQuotesBadge.textContent = data.quote_requests_count || '0';
                
                // Animate new cards
                animateNewCards();
            }
        }
        
        if (data.responses_html) {
            const responsesContent = document.getElementById('responsesContent');
            if (responsesContent) {
                responsesContent.innerHTML = data.responses_html;
                responsesBadge.textContent = data.seller_responses_count || '0';
            }
        }
    }
    
    // Show loading indicator
    function showLoading() {
        loadingIndicator.style.display = 'flex';
        loadingIndicator.style.animation = 'slideUp 0.3s ease-out';
    }
    
    // Hide loading indicator
    function hideLoading() {
        loadingIndicator.style.display = 'none';
    }
    
    // Update connection status
    function updateConnectionStatus(status) {
        const statusDot = connectionStatus.querySelector('.quote-inbox__status-dot');
        const statusText = connectionStatus.childNodes[2]; // Text node
        
        switch (status) {
            case 'connected':
                statusDot.style.backgroundColor = '#22c55e';
                statusText.textContent = 'Live';
                break;
            case 'error':
                statusDot.style.backgroundColor = '#ef4444';
                statusText.textContent = 'Error';
                break;
            case 'updating':
                statusDot.style.backgroundColor = '#f59e0b';
                statusText.textContent = 'Updating';
                break;
        }
    }
    
    // Update last updated time
    function updateLastUpdatedTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        lastUpdated.textContent = `Updated at ${timeString}`;
    }
    
    // Show notification
    function showNotification(message, type = 'info') {
        // Create notification element
        const notification = document.createElement('div');
        notification.className = `quote-inbox__notification quote-inbox__notification--${type}`;
        notification.innerHTML = `
            <div class="quote-inbox__notification-content">
                <span class="quote-inbox__notification-message">${message}</span>
                <button class="quote-inbox__notification-close">&times;</button>
            </div>
        `;
        
        // Add to DOM
        document.body.appendChild(notification);
        
        // Animate in
        setTimeout(() => {
            notification.classList.add('quote-inbox__notification--show');
        }, 10);
        
        // Auto remove after 5 seconds
        setTimeout(() => {
            removeNotification(notification);
        }, 5000);
        
        // Close button functionality
        notification.querySelector('.quote-inbox__notification-close').addEventListener('click', () => {
            removeNotification(notification);
        });
    }
    
    // Remove notification
    function removeNotification(notification) {
        notification.classList.remove('quote-inbox__notification--show');
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }
    
    // Animate new cards
    function animateNewCards() {
        const cards = document.querySelectorAll('.quote-inbox__card');
        cards.forEach((card, index) => {
            card.style.animation = 'none';
            card.offsetHeight; // Trigger reflow
            card.style.animation = `slideUp 0.5s ease-out ${index * 0.1}s both`;
        });
    }
    
    // Periodic refresh (every 30 seconds - less frequent to reduce unnecessary requests)
    function startPeriodicRefresh() {
        refreshInterval = setInterval(() => {
            if (!isRefreshing && document.visibilityState === 'visible') {
                refreshData();
            }
        }, 30000); // Changed from 8 seconds to 30 seconds
    }
    
    // Stop periodic refresh
    function stopPeriodicRefresh() {
        if (refreshInterval) {
            clearInterval(refreshInterval);
        }
    }
    
    // Handle page visibility changes
    document.addEventListener('visibilitychange', function() {
        if (document.visibilityState === 'visible') {
            // Page became visible, resume refreshing
            if (!refreshInterval) {
                startPeriodicRefresh();
            }
            // Refresh immediately if page was hidden for more than 2 minutes
            if (Date.now() - lastUpdateTime > 120000) {
                refreshData();
            }
        } else {
            // Page became hidden, stop refreshing
            stopPeriodicRefresh();
        }
    });
    
    // Initialize
    updateLastUpdatedTime();
    startPeriodicRefresh();
    
    // Handle page unload
    window.addEventListener('beforeunload', () => {
        stopPeriodicRefresh();
    });
    
    // Real-time updates are now handled by intelligent polling
    // Only shows notifications when there are actual changes
});
</script>
{% endblock %}



{% endblock %}